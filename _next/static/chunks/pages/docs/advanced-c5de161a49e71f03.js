(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{874:function(e,n,t){"use strict";var s=t(6935),o={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,n){var t,a,r,l,i,c,d,h,p=!1;n||(n={}),r=n.debug||!1;try{if(i=s(),c=document.createRange(),d=document.getSelection(),(h=document.createElement("span")).textContent=e,h.ariaHidden="true",h.style.all="unset",h.style.position="fixed",h.style.top=0,h.style.clip="rect(0, 0, 0, 0)",h.style.whiteSpace="pre",h.style.webkitUserSelect="text",h.style.MozUserSelect="text",h.style.msUserSelect="text",h.style.userSelect="text",h.addEventListener("copy",function(t){if(t.stopPropagation(),n.format){if(t.preventDefault(),void 0===t.clipboardData){r&&console.warn("unable to use e.clipboardData"),r&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var s=o[n.format]||o.default;window.clipboardData.setData(s,e)}else t.clipboardData.clearData(),t.clipboardData.setData(n.format,e)}n.onCopy&&(t.preventDefault(),n.onCopy(t.clipboardData))}),document.body.appendChild(h),c.selectNodeContents(h),d.addRange(c),!document.execCommand("copy"))throw Error("copy command was unsuccessful");p=!0}catch(s){r&&console.error("unable to copy using execCommand: ",s),r&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(n.format||"text",e),n.onCopy&&n.onCopy(window.clipboardData),p=!0}catch(s){r&&console.error("unable to copy using clipboardData: ",s),r&&console.error("falling back to prompt"),t="message"in n?n.message:"Copy to clipboard: #{key}, Enter",a=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C",l=t.replace(/#{\s*key\s*}/g,a),window.prompt(l,e)}}finally{d&&("function"==typeof d.removeRange?d.removeRange(c):d.removeAllRanges()),h&&document.body.removeChild(h),i()}return p}},5139:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/advanced",function(){return t(7111)}])},7111:function(e,n,t){"use strict";t.r(n),t.d(n,{Configurator:function(){return d}});var s=t(1527),o=t(2027),a=t(6736);t(421);var r=t(9173),l=t(959),i=t(874),c=t.n(i);let d=e=>{let{args:n,template:t,env:o}=e,r=Object.assign({div:"div",h2:"h2",span:"span",button:"button",svg:"svg",path:"path",pre:"pre",code:"code",input:"input"},(0,a.ah)()),[i,d]=(0,l.useState)([]),[h,p]=(0,l.useState)(Object.keys(o).map(e=>o[e].default)),[u,x]=(0,l.useState)(t),m=e=>{i.includes(e)?d(i.filter(n=>n!==e)):d([...i,e])},g=(e,n)=>{let t=[...h];t[e]=n,p(t)};return(0,l.useEffect)(()=>{let e=u.replace(/args:\s*'([^']*)'/,"args: '".concat(i.join(" "),"'")),n=e.replace(/env:\s*{([^}]*)}/,"env: {\n        ".concat(Object.keys(o).map((e,n)=>"".concat(e,": '").concat(h[n],"'")).join(", \n        "),"\n      }"));x(n)},[i,h]),(0,s.jsxs)(r.div,{children:[(0,s.jsxs)(r.div,{className:"p-4 mt-2",children:[(0,s.jsxs)(r.div,{id:"config",className:"border rounded-lg overflow-hidden h-12 mb-4",style:{height:"66.4px",transition:"height 0.5s ease-in-out"},children:[(0,s.jsxs)(r.div,{className:"flex cursor-pointer items-center justify-between bg-gray-100 p-4",onClick:()=>{let e=document.getElementById("config"),n=e.classList.contains("h-12");if(n){let n=e.scrollHeight;for(let t=0;t<11;t++)setTimeout(()=>{e.style.height="".concat(n/10*t,"px")},50*t);e.classList.remove("h-12")}else{let n=e.scrollHeight;for(let t=0;t<11;t++){if(10===t){setTimeout(()=>{e.style.height="66.4px"},50*t);break}setTimeout(()=>{e.style.height="".concat(n-n/10*t,"px")},50*t)}e.classList.add("h-12")}},children:[(0,s.jsxs)(r.h2,{className:"text-sm text-gray-500",children:[(0,s.jsx)(r.span,{className:"text-black",children:"ecosystem.config.js"})," 配置文件 (点击展开)"]}),(0,s.jsx)(r.button,{type:"button",className:"text-gray-500 focus:outline-none hover:text-black transition duration-300",children:(0,s.jsxs)(r.svg,{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,s.jsx)(r.path,{fillRule:"evenodd",d:"M10 12a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"}),(0,s.jsx)(r.path,{fillRule:"evenodd",d:"M10 2a8 8 0 100 16 8 8 0 000-16zM2 10a8 8 0 1116 0 8 8 0 01-16 0z",clipRule:"evenodd"})]})})]}),(0,s.jsx)(r.div,{className:"p-4",children:(0,s.jsx)(r.pre,{className:"rounded-lg text-sm",children:(0,s.jsx)(r.code,{children:u})})})]}),(0,s.jsx)(r.h2,{className:"text-xl font-semibold mb-4",children:"环境变量"}),Object.keys(o).map((e,n)=>(0,s.jsxs)(r.div,{className:"flex items-center space-x-4 mb-4",children:[(0,s.jsx)(r.input,{type:"text",className:"border rounded px-2 py-2 w-1/2 bg-transparent focus:outline-none focus:border-black hover:border-white-400 transition duration-300 font-[400] font-sans text-sm cursor-not-allowed",value:"".concat(e," (").concat(o[e].tip,")"),disabled:!0}),(0,s.jsx)(r.input,{type:o[e].type,className:"border rounded px-2 py-2 w-1/2 focus:outline-none focus:border-black hover:border-gray-400 transition duration-300 font-[400] font-sans text-sm",style:{outline:"none",boxShadow:"none"},placeholder:"Enter value...",value:h[Object.keys(o).indexOf(e)],onChange:e=>g(n,e.target.value)})]},e))]}),(0,s.jsxs)(r.div,{className:"flex p-4",children:[(0,s.jsx)(r.h2,{className:"text-xl font-semibold mb-4",children:"配置选项"}),n.map(e=>(0,s.jsx)(r.button,{className:"border rounded px-2 py-2 mr-4 mb-4 focus:outline-none focus:border-black hover:border-gray-400 transition duration-300 font-[400] font-sans text-sm ".concat(i.includes(e)?"bg-gray-200":"bg-transparent"),onClick:()=>m(e),children:e},e))]}),(0,s.jsx)(r.button,{type:"button",className:"border bg-black w-full text-white px-4 py-2 rounded-lg text-sm transform transition-all duration-300 focus:outline-none hover:bg-gray-700",onClick:()=>{c()(updatedEnvTemplate)},children:"复制"})]})};function h(e){let n=Object.assign({h1:"h1",p:"p",strong:"strong",h2:"h2",ul:"ul",li:"li",a:"a",h3:"h3",pre:"pre",code:"code",span:"span",ol:"ol"},(0,a.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{children:"进阶部署"}),"\n","\n",(0,s.jsxs)(r.UW,{type:"error",children:[(0,s.jsxs)(n.p,{children:["在您进行进阶部署前，我们给予最后的警告：如果你",(0,s.jsx)(n.strong,{children:"不是开发者"}),"，或者",(0,s.jsx)(n.strong,{children:"不想折腾"}),"，请不要选择",(0,s.jsx)(n.strong,{children:"进阶部署"}),"，因为它需要你具备一定的开发能力。"]}),(0,s.jsxs)(n.p,{children:["由于自身技术原因导致的问题，我们将",(0,s.jsx)(n.strong,{children:"不会提供任何技术支持"}),"。情节严重者，我们将",(0,s.jsx)(n.strong,{children:"永久拉黑"}),"您的账号。"]})]}),"\n",(0,s.jsx)(n.h2,{id:"要求",children:"要求"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["已安装 ",(0,s.jsx)(n.a,{href:"https://nodejs.org/zh-cn/",children:"Node.js"})," 16.0.0 或以上版本"]}),"\n",(0,s.jsxs)(n.li,{children:["已安装 ",(0,s.jsx)(n.a,{href:"https://git-scm.com/downloads",children:"Git"}),", ",(0,s.jsx)(n.a,{href:"https://pnpm.io/installation",children:"PNPM"}),", ",(0,s.jsx)(n.a,{href:"https://pm2.keymetrics.io/docs/usage/quick-start/",children:"PM2"})]}),"\n",(0,s.jsxs)(n.li,{children:["已安装 ",(0,s.jsx)(n.a,{href:"https://www.mongodb.com/try/download/community",children:"MongoDB"}),", ",(0,s.jsx)(n.a,{href:"https://redis.io/download",children:"Redis"})," 并正常运行"]}),"\n"]}),"\n","\n",(0,s.jsxs)(r.Rg,{children:[(0,s.jsx)(n.h3,{id:"1-克隆并安装",children:"1. 克隆并安装"}),(0,s.jsx)(n.pre,{"data-language":"bash","data-theme":"default",hasCopyCode:!0,children:(0,s.jsxs)(n.code,{"data-language":"bash","data-theme":"default",children:[(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"git"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"clone"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"https://github.com/mx-space/core.git"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"--depth=1"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"cd"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"core"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"pnpm"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"i"})]})]})}),(0,s.jsx)(n.h3,{id:"2-构建--bundle",children:"2. 构建 & Bundle"}),(0,s.jsx)(n.pre,{"data-language":"bash","data-theme":"default",hasCopyCode:!0,children:(0,s.jsxs)(n.code,{"data-language":"bash","data-theme":"default",children:[(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"pnpm"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"build"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"pnpm"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"bundle"})]})]})}),(0,s.jsx)(n.h3,{id:"3-配置-ecosystemconfigjs",children:"3. 配置 ecosystem.config.js"}),(0,s.jsx)(d,{args:["--color","--encrypt_enable"],env:{MX_ENCRYPT_KEY:{type:"password",tip:"加密密钥，可选",default:"mx-space"},PORT:{type:"number",tip:"服务端口，可选",default:3e3},ALLOWED_ORIGINS:{type:"text",tip:"允许跨域的域名，多个域名用逗号分隔",default:"innei.ren,www.innei.ren"},JWT_SECRET:{type:"password",tip:"JWT 密钥，用于生成 JWT Token，可选",default:"asdoiasjdoiasjdioasjdioasjdio"}},template:"const { cpus } = require('os')\nconst { execSync } = require('child_process')\nconst nodePath = execSync(`npm root --quiet -g`, { encoding: 'utf-8' }).split(\n  '\n',\n)[0]\nconst cpuLen = cpus().length\nmodule.exports = {\n  apps: [\n    {\n      name: 'mx-server',\n      script: 'out/index.js',\n      autorestart: true,\n      exec_mode: 'cluster',\n      watch: false,\n      instances: cpuLen,\n      max_memory_restart: '520M',\n      args: '',\n      env: {\n        NODE_ENV: 'production',\n        NODE_PATH: nodePath,\n        MX_ENCRYPT_KEY: process.env.MX_ENCRYPT_KEY,\n        PORT: process.env.PORT,\n      },\n    },\n  ],\n}  \n"}),(0,s.jsx)(n.h3,{id:"4-启动",children:"4. 启动"}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["进入 ",(0,s.jsx)(n.code,{children:"./apps/core/out"}),"，创建一个 ",(0,s.jsx)(n.code,{children:"ecosystem.config.js"})," 文件"]}),"\n",(0,s.jsx)(n.li,{children:"将上方复制的内容黏贴进去，然后执行以下命令启动服务"}),"\n"]}),(0,s.jsx)(n.pre,{"data-language":"bash","data-theme":"default",hasCopyCode:!0,children:(0,s.jsx)(n.code,{"data-language":"bash","data-theme":"default",children:(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"pm2"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"start"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"ecosystem.config.js"})]})})}),(0,s.jsx)(n.h3,{id:"5-反向代理-or-",children:"5. 反向代理 or ..."}),(0,s.jsxs)(n.p,{children:["剩下的就是你的事了，你可以使用 ",(0,s.jsx)(n.a,{href:"https://nginx.org/en/download.html",children:"Nginx"})," 或者 ",(0,s.jsx)(n.a,{href:"https://caddyserver.com/download",children:"Caddy"})," 等反向代理工具，也可以使用 ",(0,s.jsx)(n.a,{href:"https://www.cloudflare.com/",children:"Cloudflare"})," 等 CDN 服务。本文不再赘述。"]})]})]})}n.default=(0,o.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)},pageOpts:{filePath:"pages/docs/advanced.mdx",route:"/docs/advanced",headings:[{depth:1,value:"进阶部署",id:"进阶部署"},{depth:2,value:"要求",id:"要求"},{depth:3,value:"1. 克隆并安装",id:"1-克隆并安装"},{depth:3,value:"2. 构建 & Bundle",id:"2-构建--bundle"},{depth:3,value:"3. 配置 ecosystem.config.js",id:"3-配置-ecosystemconfigjs"},{depth:3,value:"4. 启动",id:"4-启动"},{depth:3,value:"5. 反向代理 or ...",id:"5-反向代理-or-"}],title:"进阶部署"},pageNextRoute:"/docs/advanced"})},6935:function(e){e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var n=document.activeElement,t=[],s=0;s<e.rangeCount;s++)t.push(e.getRangeAt(s));switch(n.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":n.blur();break;default:n=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||t.forEach(function(n){e.addRange(n)}),n&&n.focus()}}}},function(e){e.O(0,[48,774,888,179],function(){return e(e.s=5139)}),_N_E=e.O()}]);