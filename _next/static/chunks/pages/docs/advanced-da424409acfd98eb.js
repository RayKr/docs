(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{874:function(e,t,n){"use strict";var s=n(6935),a={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,t){var n,r,o,l,i,c,d,h,p=!1;t||(t={}),o=t.debug||!1;try{if(i=s(),c=document.createRange(),d=document.getSelection(),(h=document.createElement("span")).textContent=e,h.ariaHidden="true",h.style.all="unset",h.style.position="fixed",h.style.top=0,h.style.clip="rect(0, 0, 0, 0)",h.style.whiteSpace="pre",h.style.webkitUserSelect="text",h.style.MozUserSelect="text",h.style.msUserSelect="text",h.style.userSelect="text",h.addEventListener("copy",function(n){if(n.stopPropagation(),t.format){if(n.preventDefault(),void 0===n.clipboardData){o&&console.warn("unable to use e.clipboardData"),o&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var s=a[t.format]||a.default;window.clipboardData.setData(s,e)}else n.clipboardData.clearData(),n.clipboardData.setData(t.format,e)}t.onCopy&&(n.preventDefault(),t.onCopy(n.clipboardData))}),document.body.appendChild(h),c.selectNodeContents(h),d.addRange(c),!document.execCommand("copy"))throw Error("copy command was unsuccessful");p=!0}catch(s){o&&console.error("unable to copy using execCommand: ",s),o&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),p=!0}catch(s){o&&console.error("unable to copy using clipboardData: ",s),o&&console.error("falling back to prompt"),n="message"in t?t.message:"Copy to clipboard: #{key}, Enter",r=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C",l=n.replace(/#{\s*key\s*}/g,r),window.prompt(l,e)}}finally{d&&("function"==typeof d.removeRange?d.removeRange(c):d.removeAllRanges()),h&&document.body.removeChild(h),i()}return p}},6316:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/advanced",function(){return n(6002)}])},6002:function(e,t,n){"use strict";n.r(t),n.d(t,{Configurator:function(){return d}});var s=n(1527),a=n(985),r=n(6736);n(8823);var o=n(5032),l=n(959),i=n(874),c=n.n(i);let d=e=>{let{args:t,template:n,env:a}=e,o=Object.assign({div:"div",h2:"h2",span:"span",button:"button",svg:"svg",path:"path",pre:"pre",code:"code",input:"input"},(0,r.ah)()),[i,d]=(0,l.useState)([]),[h,p]=(0,l.useState)(Object.keys(a).map(e=>a[e].default)),[u,x]=(0,l.useState)(n),g=e=>{i.includes(e)?d(i.filter(t=>t!==e)):d([...i,e])},m=(e,t)=>{let n=[...h];n[e]=t,p(n)},f=()=>{c()(updatedEnvTemplate)};return(0,l.useEffect)(()=>{let e=u.replace(/args:\s*'([^']*)'/,"args: '".concat(i.join(" "),"'")),t=e.replace(/env:\s*{([^}]*)}/,"env: {\n        ".concat(Object.keys(a).map((e,t)=>"".concat(e,": '").concat(h[t],"'")).join(", \n        "),"\n      }"));x(t)},[i,h]),(0,s.jsxs)(o.div,{children:[(0,s.jsxs)(o.div,{className:"p-4 mt-2",children:[(0,s.jsxs)(o.div,{id:"config",className:"border rounded-lg overflow-hidden h-12 mb-4 dark:border-gray-700 ",style:{height:"66.4px",transition:"height 0.5s ease-in-out"},children:[(0,s.jsxs)(o.div,{className:"flex cursor-pointer items-center justify-between bg-gray-100 p-4 dark:bg-gray-700",onClick:()=>{let e=document.getElementById("config"),t=e.classList.contains("h-12");if(t){let t=e.scrollHeight;for(let n=0;n<11;n++)setTimeout(()=>{e.style.height="".concat(t/10*n,"px")},50*n);e.classList.remove("h-12")}else{let t=e.scrollHeight;for(let n=0;n<11;n++){if(10===n){setTimeout(()=>{e.style.height="66.4px"},50*n);break}setTimeout(()=>{e.style.height="".concat(t-t/10*n,"px")},50*n)}e.classList.add("h-12")}},children:[(0,s.jsxs)(o.h2,{className:"text-sm text-gray-500 dark:text-gray-300",children:[(0,s.jsx)(o.span,{className:"text-black dark:text-gray-300",children:"ecosystem.config.js"})," 配置文件 (点击展开)"]}),(0,s.jsx)(o.button,{type:"button",className:"text-gray-500 focus:outline-none hover:text-black transition duration-300",children:(0,s.jsxs)(o.svg,{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,s.jsx)(o.path,{fillRule:"evenodd",d:"M10 12a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"}),(0,s.jsx)(o.path,{fillRule:"evenodd",d:"M10 2a8 8 0 100 16 8 8 0 000-16zM2 10a8 8 0 1116 0 8 8 0 01-16 0z",clipRule:"evenodd"})]})})]}),(0,s.jsx)(o.div,{className:"p-4",children:(0,s.jsx)(o.pre,{className:"rounded-lg text-sm",children:(0,s.jsx)(o.code,{children:u})})})]}),(0,s.jsx)(o.h2,{className:"text-xl font-semibold mb-4",children:"环境变量"}),Object.keys(a).map((e,t)=>(0,s.jsxs)(o.div,{className:"flex items-center space-x-4 mb-4",children:[(0,s.jsx)(o.input,{type:"text",className:"border rounded px-2 py-2 w-1/2 bg-transparent focus:outline-none focus:border-black hover:border-white-400 transition duration-300 font-[400] font-sans text-sm cursor-not-allowed dark:border-gray-700 dark:text-gray-300",value:"".concat(e," (").concat(a[e].tip,")"),disabled:!0}),(0,s.jsx)(o.input,{type:a[e].type,className:"border rounded px-2 py-2 w-1/2 focus:outline-none focus:border-black hover:border-gray-400 transition duration-300 font-[400] font-sans text-sm dark:border-gray-700 dark:text-gray-300",style:{outline:"none",boxShadow:"none"},placeholder:"Enter value...",value:h[Object.keys(a).indexOf(e)],onChange:e=>m(t,e.target.value)})]},e))]}),(0,s.jsxs)(o.div,{className:"flex p-4",children:[(0,s.jsx)(o.h2,{className:"text-xl font-semibold mb-4",children:"配置选项"}),t.map(e=>(0,s.jsx)(o.button,{className:"border rounded px-2 py-2 mr-4 mb-4 focus:outline-none focus:border-black hover:border-gray-400 transition duration-300 font-[400] font-sans text-sm  dark:border-gray-700 dark:text-gray-300 ".concat(i.includes(e)?"bg-gray-200 dark:bg-gray-800":"bg-transparent"),onClick:()=>g(e),children:e},e))]}),(0,s.jsx)(o.button,{type:"button",className:"border bg-black w-full text-white px-4 py-2 rounded-lg text-sm transform transition-all duration-300 focus:outline-none hover:bg-gray-700 dark:border-gray-700 dark:text-gray-300 ",onClick:f,children:"复制"})]})};function h(e){let t=Object.assign({h1:"h1",p:"p",strong:"strong",h2:"h2",ul:"ul",li:"li",a:"a",h3:"h3",pre:"pre",code:"code",span:"span",ol:"ol"},(0,r.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{children:"进阶部署"}),"\n","\n",(0,s.jsxs)(o.UW,{type:"error",children:[(0,s.jsxs)(t.p,{children:["在您进行进阶部署前，我们给予最后的警告：如果你",(0,s.jsx)(t.strong,{children:"不是开发者"}),"，或者",(0,s.jsx)(t.strong,{children:"不想折腾"}),"，请不要选择",(0,s.jsx)(t.strong,{children:"进阶部署"}),"，因为它需要你具备一定的开发能力。"]}),(0,s.jsxs)(t.p,{children:["由于自身技术原因导致的问题，我们将",(0,s.jsx)(t.strong,{children:"不会提供任何技术支持"}),"。情节严重者，我们将",(0,s.jsx)(t.strong,{children:"永久拉黑"}),"您的账号。"]})]}),"\n",(0,s.jsx)(t.h2,{id:"要求",children:"要求"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["已安装 ",(0,s.jsx)(t.a,{href:"https://nodejs.org/zh-cn/",children:"Node.js"})," 16.0.0 或以上版本"]}),"\n",(0,s.jsxs)(t.li,{children:["已安装 ",(0,s.jsx)(t.a,{href:"https://git-scm.com/downloads",children:"Git"}),", ",(0,s.jsx)(t.a,{href:"https://pnpm.io/installation",children:"PNPM"}),", ",(0,s.jsx)(t.a,{href:"https://pm2.keymetrics.io/docs/usage/quick-start/",children:"PM2"})]}),"\n",(0,s.jsxs)(t.li,{children:["已安装 ",(0,s.jsx)(t.a,{href:"https://www.mongodb.com/try/download/community",children:"MongoDB"}),", ",(0,s.jsx)(t.a,{href:"https://redis.io/download",children:"Redis"})," 并正常运行"]}),"\n"]}),"\n","\n",(0,s.jsxs)(o.Rg,{children:[(0,s.jsx)(t.h3,{id:"1-克隆并安装",children:"1. 克隆并安装"}),(0,s.jsx)(t.pre,{"data-language":"bash","data-theme":"default",hasCopyCode:!0,children:(0,s.jsxs)(t.code,{"data-language":"bash","data-theme":"default",children:[(0,s.jsxs)(t.span,{className:"line",children:[(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-function)"},children:"git"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"clone"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"https://github.com/mx-space/core.git"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"--depth=1"})]}),"\n",(0,s.jsxs)(t.span,{className:"line",children:[(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-function)"},children:"cd"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"core"})]}),"\n",(0,s.jsxs)(t.span,{className:"line",children:[(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-function)"},children:"pnpm"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"i"})]})]})}),(0,s.jsx)(t.h3,{id:"2-构建--bundle",children:"2. 构建 & Bundle"}),(0,s.jsx)(t.pre,{"data-language":"bash","data-theme":"default",hasCopyCode:!0,children:(0,s.jsxs)(t.code,{"data-language":"bash","data-theme":"default",children:[(0,s.jsxs)(t.span,{className:"line",children:[(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-function)"},children:"pnpm"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"build"})]}),"\n",(0,s.jsxs)(t.span,{className:"line",children:[(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-function)"},children:"pnpm"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"bundle"})]})]})}),(0,s.jsx)(t.h3,{id:"3-配置-ecosystemconfigjs",children:"3. 配置 ecosystem.config.js"}),(0,s.jsx)(d,{args:["--color","--encrypt_enable"],env:{MX_ENCRYPT_KEY:{type:"password",tip:"加密密钥，可选",default:"mx-space"},PORT:{type:"number",tip:"服务端口，可选",default:3e3},ALLOWED_ORIGINS:{type:"text",tip:"允许跨域的域名，多个域名用逗号分隔",default:"innei.ren,www.innei.ren"},JWT_SECRET:{type:"password",tip:"JWT 密钥，用于生成 JWT Token，可选",default:"asdoiasjdoiasjdioasjdioasjdio"}},template:"const { cpus } = require('os')\nconst { execSync } = require('child_process')\nconst nodePath = execSync(`npm root --quiet -g`, { encoding: 'utf-8' }).split(\n  '\n',\n)[0]\nconst cpuLen = cpus().length\nmodule.exports = {\n  apps: [\n    {\n      name: 'mx-server',\n      script: 'out/index.js',\n      autorestart: true,\n      exec_mode: 'cluster',\n      watch: false,\n      instances: cpuLen,\n      max_memory_restart: '520M',\n      args: '',\n      env: {\n        NODE_ENV: 'production',\n        NODE_PATH: nodePath,\n        MX_ENCRYPT_KEY: process.env.MX_ENCRYPT_KEY,\n        PORT: process.env.PORT,\n      },\n    },\n  ],\n}  \n"}),(0,s.jsx)(t.h3,{id:"4-启动",children:"4. 启动"}),(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["进入 ",(0,s.jsx)(t.code,{children:"./apps/core/out"}),"，创建一个 ",(0,s.jsx)(t.code,{children:"ecosystem.config.js"})," 文件"]}),"\n",(0,s.jsx)(t.li,{children:"将上方复制的内容黏贴进去，然后执行以下命令启动服务"}),"\n"]}),(0,s.jsx)(t.pre,{"data-language":"bash","data-theme":"default",hasCopyCode:!0,children:(0,s.jsx)(t.code,{"data-language":"bash","data-theme":"default",children:(0,s.jsxs)(t.span,{className:"line",children:[(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-function)"},children:"pm2"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"start"}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(t.span,{style:{color:"var(--shiki-token-string)"},children:"ecosystem.config.js"})]})})}),(0,s.jsx)(t.h3,{id:"5-反向代理-or-",children:"5. 反向代理 or ..."}),(0,s.jsxs)(t.p,{children:["剩下的就是你的事了，你可以使用 ",(0,s.jsx)(t.a,{href:"https://nginx.org/en/download.html",children:"Nginx"})," 或者 ",(0,s.jsx)(t.a,{href:"https://caddyserver.com/download",children:"Caddy"})," 等反向代理工具，也可以使用 ",(0,s.jsx)(t.a,{href:"https://www.cloudflare.com/",children:"Cloudflare"})," 等 CDN 服务。本文不再赘述。"]})]})]})}t.default=(0,a.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,r.ah)(),e.components);return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)},pageOpts:{filePath:"pages/docs/advanced.mdx",route:"/docs/advanced",headings:[{depth:1,value:"进阶部署",id:"进阶部署"},{depth:2,value:"要求",id:"要求"},{depth:3,value:"1. 克隆并安装",id:"1-克隆并安装"},{depth:3,value:"2. 构建 & Bundle",id:"2-构建--bundle"},{depth:3,value:"3. 配置 ecosystem.config.js",id:"3-配置-ecosystemconfigjs"},{depth:3,value:"4. 启动",id:"4-启动"},{depth:3,value:"5. 反向代理 or ...",id:"5-反向代理-or-"}],title:"进阶部署"},pageNextRoute:"/docs/advanced"})},6935:function(e){e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],s=0;s<e.rangeCount;s++)n.push(e.getRangeAt(s));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach(function(t){e.addRange(t)}),t&&t.focus()}}}},function(e){e.O(0,[985,774,888,179],function(){return e(e.s=6316)}),_N_E=e.O()}]);